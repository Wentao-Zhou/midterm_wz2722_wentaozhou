<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="midterm_wz2722_p8105">midterm_wz2722_p8105</h1>
<p>wentao zhou 2024-10-21</p>
<p>Q1.Data import and cleaning Part 1.NYC rental data import and
cleaning</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># Step 1: Import and clean NYC rental data (ZORI)</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>zori_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), </span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;rent_price&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">ymd</span>(<span class="fu">paste0</span>(<span class="fu">str_remove_all</span>(month, <span class="st">&quot;x&quot;</span>), <span class="st">&quot;-01&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_price))  <span class="co"># Remove rows with missing rental prices</span></span></code></pre></div>
<pre><code>## Rows: 149 Columns: 125
## ── Column specification ─────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr   (6): RegionType, StateName, State, City, Metro, CountyName
## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-31...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `month = ymd(paste0(str_remove_all(month, &quot;x&quot;), &quot;-01&quot;))`.
## Caused by warning:
## ! All formats failed to parse. No formats found.</code></pre>
<p>Part 2.Import and Clean ZIP Code Data</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Step 2: Import and clean ZIP code data from the HTML page</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://p8105.com/data/zip_codes.html&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>zip_codes_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  .[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">clean_names</span>()  <span class="co"># Clean column names</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co"># Add a borough variable using county names</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>zip_codes_data <span class="ot">&lt;-</span> zip_codes_data <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">borough =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">&quot;Bronx&quot;</span> <span class="sc">~</span> <span class="st">&quot;Bronx&quot;</span>,</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">&quot;Kings&quot;</span> <span class="sc">~</span> <span class="st">&quot;Brooklyn&quot;</span>,</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">&quot;New York&quot;</span> <span class="sc">~</span> <span class="st">&quot;Manhattan&quot;</span>,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">&quot;Queens&quot;</span> <span class="sc">~</span> <span class="st">&quot;Queens&quot;</span>,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">&quot;Richmond&quot;</span> <span class="sc">~</span> <span class="st">&quot;Staten Island&quot;</span>,</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span></code></pre></div>
<p>Merge Rental Data with ZIP Code Data</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Step 3: Merge rental data with ZIP code data by matching ZIP codes</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># Ensure both columns are of character type before joining</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>zori_data <span class="ot">&lt;-</span> zori_data <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_name =</span> <span class="fu">as.character</span>(region_name))</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>zip_codes_data <span class="ot">&lt;-</span> zip_codes_data <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip_code =</span> <span class="fu">as.character</span>(zip_code))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># Now perform the inner join</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>zori_merged <span class="ot">&lt;-</span> zori_data <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="fu">inner_join</span>(zip_codes_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;region_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip_code&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in inner_join(., zip_codes_data, by = c(region_name = &quot;zip_code&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 2759 of `x` matches multiple rows in `y`.
## ℹ Row 256 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship =
##   &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Print summary statistics</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Total observations in rental data:&quot;</span>, <span class="fu">nrow</span>(zori_merged), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Total observations in rental data: 10677</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Unique ZIP codes in rental data:&quot;</span>, <span class="fu">n_distinct</span>(zori_merged<span class="sc">$</span>region_name), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Unique ZIP codes in rental data: 149</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Unique neighborhoods:&quot;</span>, <span class="fu">n_distinct</span>(zori_merged<span class="sc">$</span>borough), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Unique neighborhoods: 5</code></pre>
<p>Part 4: Import and Clean US Housing Data</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Step 4: Import and clean US housing data (ZHVI)</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>zhvi_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Zip_zhvi_uc_sfrcondo_tier_0.33_0.67_sm_sa_month_2023.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), </span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;house_value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">ymd</span>(<span class="fu">paste0</span>(<span class="fu">str_remove_all</span>(month, <span class="st">&quot;x&quot;</span>), <span class="st">&quot;-01&quot;</span>)))</span></code></pre></div>
<pre><code>## Rows: 26338 Columns: 21
## ── Column specification ─────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): RegionName, RegionType, StateName, State, City, Metro, CountyName
## dbl (14): RegionID, SizeRank, 2023-01-31, 2023-02-28, 2023-03-31, 2023-04-30,...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `month = ymd(paste0(str_remove_all(month, &quot;x&quot;), &quot;-01&quot;))`.
## Caused by warning:
## ! All formats failed to parse. No formats found.</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Step 5: Merge housing data with ZIP code data</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co"># Convert both region_name and zip_code to character type</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>zhvi_data <span class="ot">&lt;-</span> zhvi_data <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_name =</span> <span class="fu">as.character</span>(region_name))</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>zip_codes_data <span class="ot">&lt;-</span> zip_codes_data <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip_code =</span> <span class="fu">as.character</span>(zip_code))</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co"># Perform the inner join</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>zhvi_merged <span class="ot">&lt;-</span> zhvi_data <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="fu">inner_join</span>(zip_codes_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;region_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip_code&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in inner_join(., zip_codes_data, by = c(region_name = &quot;zip_code&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 2125 of `x` matches multiple rows in `y`.
## ℹ Row 256 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship =
##   &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Check the merged data</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">glimpse</span>(zhvi_merged)</span></code></pre></div>
<pre><code>## Rows: 2,196
## Columns: 18
## $ region_id    [3m[38;5;246m&lt;dbl&gt;[39m[23m 62080, 62080, 62080, 62080, 62080, 62080, 62080, 62080, 62…
## $ size_rank    [3m[38;5;246m&lt;dbl&gt;[39m[23m 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 7, 7, 7, 7, 7, 7, 7, 7…
## $ region_name  [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;11368&quot;, &quot;11368&quot;, &quot;11368&quot;, &quot;11368&quot;, &quot;11368&quot;, &quot;11368&quot;, &quot;113…
## $ region_type  [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;zip&quot;, &quot;zip&quot;, &quot;zip&quot;, &quot;zip&quot;, &quot;zip&quot;, &quot;zip&quot;, &quot;zip&quot;, &quot;zip&quot;, &quot;z…
## $ state_name   [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;…
## $ state        [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;, &quot;NY&quot;…
## $ city         [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;New York&quot;, &quot;New York&quot;, &quot;New York&quot;, &quot;New York&quot;, &quot;New York&quot;…
## $ metro        [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;New York-Newark-Jersey City, NY-NJ-PA&quot;, &quot;New York-Newark-…
## $ county_name  [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;Queens County&quot;, &quot;Queens County&quot;, &quot;Queens County&quot;, &quot;Queens…
## $ month        [3m[38;5;246m&lt;date&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ house_value  [3m[38;5;246m&lt;dbl&gt;[39m[23m 492391.8, 485556.5, 479262.8, 472667.7, 465596.7, 460226.3…
## $ county       [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;…
## $ state_fips   [3m[38;5;246m&lt;int&gt;[39m[23m 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36…
## $ county_code  [3m[38;5;246m&lt;int&gt;[39m[23m 81, 81, 81, 81, 81, 81, 81, 81, 81, 81, 81, 81, 81, 81, 81…
## $ county_fips  [3m[38;5;246m&lt;int&gt;[39m[23m 36081, 36081, 36081, 36081, 36081, 36081, 36081, 36081, 36…
## $ file_date    [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;07/25/2007&quot;, &quot;07/25/2007&quot;, &quot;07/25/2007&quot;, &quot;07/25/2007&quot;, &quot;0…
## $ neighborhood [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;West Queens&quot;, &quot;West Queens&quot;, &quot;West Queens&quot;, &quot;West Queens&quot;…
## $ borough      [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;, &quot;Queens&quot;…</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Print the summary of merged data</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Total observations in merged housing data:&quot;</span>, <span class="fu">nrow</span>(zhvi_merged), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Total observations in merged housing data: 2196</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Unique ZIP codes in merged housing data:&quot;</span>, <span class="fu">n_distinct</span>(zhvi_merged<span class="sc">$</span>region_name), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Unique ZIP codes in merged housing data: 181</code></pre>
<p>Description of Summary of the Process</p>
<p>1.Import and Clean NYC Rental Data (ZORI):</p>
<p>Used clean_names() to standardize column names. Pivoted monthly
rental prices to a long format using pivot_longer(). Converted month
columns to Date objects with ymd() and removed rows with missing rental
prices.</p>
<p>2.Import and Clean ZIP Code Data:</p>
<p>Retrieved ZIP code data from the provided HTML page using rvest.
Added a borough variable using case_when() based on county names. Merge
Rental Data with ZIP Code Data:</p>
<p>3.Converted region_name and zip_code columns to character type for
merging. Merged rental data with ZIP code data using inner_join().</p>
<p>4.Import and Clean US Housing Data (ZHVI):</p>
<p>Cleaned and pivoted the housing data to a long format, similar to
rental data.</p>
<p>5.Merge Housing Data with ZIP Code Data:</p>
<p>Merged housing data with ZIP code data using inner_join().</p>
<p>Question 2: Quality Control and EDA</p>
<p>Part 1. Why are some postal codes observed for less than 116
months?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>months_per_zip <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;rent_price&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="fu">group_by</span>(region_name) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">observations =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_price)))</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ZIP codes with fewer than 116 observations:&quot;</span>, <span class="fu">sum</span>(months_per_zip<span class="sc">$</span>observations <span class="sc">&lt;</span> <span class="dv">116</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ZIP codes with fewer than 116 observations: 0</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>num_zip_rental <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(merged_data<span class="sc">$</span>region_name))</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>num_zip_zipcode <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(zip_codes_data<span class="sc">$</span>zip_code))</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Number of ZIP codes in rental dataset:&quot;</span>, num_zip_rental, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Number of ZIP codes in rental dataset: 48</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Number of ZIP codes in ZIP code dataset:&quot;</span>, num_zip_zipcode, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Number of ZIP codes in ZIP code dataset: 320</code></pre>
<p>Possible reasons: Rent data may be collected midway, resulting in
shorter time series for certain postal codes.</p>
<p>Data missing issue. Some postal codes may no longer be used due to
boundary changes.</p>
<p>Possible reasons for differences: Some postal codes are not included
in the rental dataset. The postal code system changes over time.</p>
<p>Part 2. Average rent per administrative region and year</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># Convert the month column to Date format</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>merged_data_long <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), </span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;rent_price&quot;</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">ymd</span>(<span class="fu">str_remove_all</span>(month, <span class="st">&quot;x&quot;</span>))  <span class="co"># Remove &#39;x&#39; and convert to Date</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>  )</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="co"># Create a table of average rental prices by borough and year</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>nyc_rental_yearly <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), </span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;rent_price&quot;</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">ymd</span>(<span class="fu">str_remove_all</span>(month, <span class="st">&quot;x&quot;</span>)),  <span class="co"># Convert to Date</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(month)  </span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>  <span class="fu">group_by</span>(borough, year) <span class="sc">%&gt;%</span></span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>    <span class="at">avg_rent_price =</span> <span class="fu">mean</span>(rent_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>  <span class="fu">arrange</span>(borough, year)</span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a><span class="co"># Print the table</span></span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a><span class="fu">print</span>(nyc_rental_yearly)</span></code></pre></div>
<pre><code>## # A tibble: 30 × 3
##    borough   year avg_rent_price
##    &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;
##  1 Brooklyn  2015          2539.
##  2 Brooklyn  2016          2617.
##  3 Brooklyn  2017          2659.
##  4 Brooklyn  2018          2704.
##  5 Brooklyn  2019          2814.
##  6 Brooklyn  2020          2787.
##  7 Brooklyn  2021          2817.
##  8 Brooklyn  2022          3309.
##  9 Brooklyn  2023          3496.
## 10 Brooklyn  2024          3610.
## # ℹ 20 more rows</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># Step 5: Compare rental prices in January 2021 vs January 2020</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>rental_price_change <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), </span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;rent_price&quot;</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">ymd</span>(<span class="fu">str_remove_all</span>(month, <span class="st">&quot;x&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">&quot;2020-01-31&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;2021-01-31&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>    <span class="at">names_from =</span> month, </span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>    <span class="at">values_from =</span> rent_price</span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_drop =</span> <span class="st">`</span><span class="at">2020-01-31</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">2021-01-31</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>  <span class="fu">group_by</span>(borough) <span class="sc">%&gt;%</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>  <span class="fu">filter</span>(price_drop <span class="sc">==</span> <span class="fu">max</span>(price_drop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>  <span class="fu">select</span>(borough, region_name, price_drop)</span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="fu">print</span>(rental_price_change)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
## # Groups:   borough [3]
##   borough   region_name price_drop
##   &lt;chr&gt;           &lt;int&gt;      &lt;dbl&gt;
## 1 Brooklyn        11211       438.
## 2 Queens          11101       128.
## 3 Manhattan       10001       710.</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co"># Comment: Rental prices have generally increased over the years, </span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co"># with notable fluctuations during the COVID-19 pandemic, especially in Manhattan and Brooklyn.</span></span></code></pre></div>
<p>Q3.Visualization Part 1.Plot NYC Rental Prices Over Time by
Borough</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># Ensure the results directory exists</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;results&quot;</span>)) {</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;results&quot;</span>)</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>}</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="co"># Reshape the rental data for plotting</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>nyc_rental_long <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), </span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, </span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;rent_price&quot;</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">ymd</span>(<span class="fu">str_remove_all</span>(month, <span class="st">&quot;x&quot;</span>)),  <span class="co"># Convert month to Date format</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(month)  <span class="co"># Extract the year as a numeric value</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>  )</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="co"># Create the plot of NYC rental prices</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>nyc_rental_plot <span class="ot">&lt;-</span> nyc_rental_long <span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> rent_price, <span class="at">color =</span> borough)) <span class="sc">+</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region_name), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Lighter lines for each ZIP code</span></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>borough) <span class="sc">+</span>  <span class="co"># Separate plots for each borough</span></span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;NYC Rental Prices within ZIP Codes for All Available Years&quot;</span>,</span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Rental Price (USD)&quot;</span>,</span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Borough&quot;</span></span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a><span class="co"># Save the plot to the results directory</span></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;results/nyc_rental_prices_plot.png&quot;</span>, nyc_rental_plot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a><span class="co"># Print confirmation message</span></span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;NYC rental prices plot saved to &#39;results/nyc_rental_prices_plot.png&#39;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## NYC rental prices plot saved to &#39;results/nyc_rental_prices_plot.png&#39;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co">#Comment:This plot shows rental price trends over time for each borough. Rental prices have generally increased across all boroughs. Notably:Manhattan exhibits the highest rental prices.Staten Island has the lowest rental prices.During the COVID-19 pandemic, rental prices dipped across several boroughs, especially in Manhattan and Brooklyn, reflecting the decline in urban demand during that period.</span></span></code></pre></div>
<p>Part 2.Compute and Plot Average House Prices in 2023</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>zhvi_avg_2023 <span class="ot">&lt;-</span> data_zhvi <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;x20&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;month&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;house_price&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="fu">group_by</span>(region_name) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_price_2023 =</span> <span class="fu">mean</span>(house_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a><span class="co"># Summary </span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Summary statistics for average house prices in 2023:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Summary statistics for average house prices in 2023:</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">summary</span>(zhvi_avg_2023<span class="sc">$</span>avg_price_2023)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   23380  173264  259124  336694  398801 7636362     116</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co"># Plot the distribution of house prices across ZIP codes</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>zhvi_avg_2023_plot <span class="ot">&lt;-</span> zhvi_avg_2023 <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> avg_price_2023)) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Distribution of ZIP-Code-Level House Prices Across States in 2023&quot;</span>,</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Average House Price (USD)&quot;</span>,</span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;results/zhvi_avg_2023_plot.png&quot;</span>, zhvi_avg_2023_plot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 116 rows containing non-finite outside the scale range
## (`stat_bin()`).</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co"># Print confirmation</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Housing prices distribution plot saved to &#39;results/zhvi_avg_2023_plot.png&#39;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Housing prices distribution plot saved to &#39;results/zhvi_avg_2023_plot.png&#39;</code></pre>
<p>Part 3. Compare Rental and Housing Prices for NYC ZIP Codes in
2023</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="co"># Compute average rental prices for 2023</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>avg_rent_2023 <span class="ot">&lt;-</span> nyc_rental_long <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(month) <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>  <span class="fu">group_by</span>(region_name) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_rent_2023 =</span> <span class="fu">mean</span>(rent_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a><span class="co"># Merge rental and housing prices</span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>price_comparison_2023 <span class="ot">&lt;-</span> avg_rent_2023 <span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>  <span class="fu">inner_join</span>(zhvi_avg_2023, <span class="at">by =</span> <span class="st">&quot;region_name&quot;</span>)</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a><span class="co"># Create the comparison plot</span></span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a>comparison_plot <span class="ot">&lt;-</span> price_comparison_2023 <span class="sc">%&gt;%</span></span>
<span id="cb44-13"><a href="#cb44-13" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> avg_rent_2023, <span class="at">y =</span> avg_price_2023)) <span class="sc">+</span></span>
<span id="cb44-14"><a href="#cb44-14" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-15"><a href="#cb44-15" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-16"><a href="#cb44-16" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-17"><a href="#cb44-17" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Comparison of Rental and Housing Prices by ZIP Code in 2023&quot;</span>,</span>
<span id="cb44-18"><a href="#cb44-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Average Rental Price (USD)&quot;</span>,</span>
<span id="cb44-19"><a href="#cb44-19" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average Housing Price (USD)&quot;</span></span>
<span id="cb44-20"><a href="#cb44-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb44-21"><a href="#cb44-21" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb44-22"><a href="#cb44-22" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb44-24"><a href="#cb44-24" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;results/comparison_plot.png&quot;</span>, comparison_plot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="co"># Print confirmation</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Comparison plot saved to &#39;results/comparison_plot.png&#39;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Comparison plot saved to &#39;results/comparison_plot.png&#39;</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="co">#Comment:The scatter plot shows a positive relationship between rental prices and housing prices: ZIP codes with higher average rental prices tend to have higher housing prices. However, the plot also reveals significant variability, suggesting that other factors, such as location, amenities, and market trends, may also influence prices.</span></span></code></pre></div>
<p>Part 4.Limitations of the Dataset</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="co"># Comment on dataset limitations</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Limitations of the dataset:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Limitations of the dataset:</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;- Missing data for some ZIP codes and inconsistent rental data for certain months.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## - Missing data for some ZIP codes and inconsistent rental data for certain months.</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;- The dataset does not account for key factors such as neighborhood amenities, transportation, or economic conditions.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## - The dataset does not account for key factors such as neighborhood amenities, transportation, or economic conditions.</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;- Seasonal fluctuations in rental and housing prices are not captured with annual averages.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## - Seasonal fluctuations in rental and housing prices are not captured with annual averages.</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;- Rental prices during the COVID-19 pandemic may show volatility, complicating trend analysis.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## - Rental prices during the COVID-19 pandemic may show volatility, complicating trend analysis.</code></pre>

</body>
</html>
